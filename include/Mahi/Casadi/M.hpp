#pragma once
#include <vector>
#include <casadi/casadi.hpp>
#include <Mahi/Casadi/mass_properties.hpp>
using namespace casadi;

SX get_M(const SX& qs){
	SX M = SX::zeros(4,4); 

	auto q0 = qs(0,0);
	auto q1 = qs(1,0);
	auto q2 = qs(2,0);
	auto q3 = qs(3,0);
	auto qd0 = qs(4,0);
	auto qd1 = qs(5,0);
	auto qd2 = qs(6,0);
	auto qd3 = qs(7,0);

	auto t2 = cos(q1);
	auto t3 = cos(q2);
	auto t4 = cos(q3);
	auto t5 = sin(q1);
	auto t6 = sin(q2);
	auto t7 = sin(q3);
	auto t8 = Pcx1*Pcx1;
	auto t9 = Pcx2*Pcx2;
	auto t10 = Pcx3*Pcx3;
	auto t11 = Pcy1*Pcy1;
	auto t12 = Pcy2*Pcy2;
	auto t13 = Pcy3*Pcy3;
	auto t14 = Pcz2*Pcz2;
	auto t15 = Pcz3*Pcz3;
	auto t16 = q1*2.0;
	auto t17 = q2*2.0;
	auto t18 = q3*2.0;
	auto t19 = t2*t2;
	auto t20 = t3*t3;
	auto t21 = t4*t4;
	auto t22 = sin(t16);
	auto t23 = sin(t17);
	auto t24 = sin(t18);
	auto t25 = Icxy2*t2;
	auto t26 = Icxz1*t2;
	auto t27 = Icxy3*t3;
	auto t28 = Icxz2*t3;
	auto t29 = Icyz3*t4;
	auto t30 = Icxx3*t5;
	auto t31 = Icxz3*t7;
	auto t32 = Icyz1*t5;
	auto t33 = Icyz2*t6;
	auto t34 = Iczz2*t5;
	auto t35 = Iczz3*t6;
	auto t36 = m1*t8;
	auto t37 = m2*t9;
	auto t38 = m3*t10;
	auto t39 = m2*t12;
	auto t40 = m3*t13;
	auto t41 = m3*t15;
	auto t42 = Pcx2*Pcy2*m2*t2;
	auto t43 = Pcx3*Pcy3*m3*t3;
	auto t44 = Pcx1*Pcz1*m1*t2;
	auto t45 = Pcx2*Pcz2*m2*t3;
	auto t46 = Pcy3*Pcz3*m3*t4;
	auto t47 = Pcx3*Pcz3*m3*t7;
	auto t48 = Pcy1*Pcz1*m1*t5;
	auto t49 = Pcy2*Pcz2*m2*t6;
	auto t50 = Icxz3*t2*t4;
	auto t51 = Icxz3*t3*t4;
	auto t52 = Icyz2*t2*t3;
	auto t53 = Iczz3*t2*t3;
	auto t54 = Icxy3*t2*t6;
	auto t56 = Icxz2*t2*t6;
	auto t58 = Icyz3*t2*t7;
	auto t60 = Icyz3*t3*t7;
	auto t80 = Pcx3*Pcz3*m3*t2*t4;
	auto t81 = Pcx3*Pcz3*m3*t3*t4;
	auto t82 = Pcy2*Pcz2*m2*t2*t3;
	auto t83 = Pcx3*Pcy3*m3*t2*t6;
	auto t85 = Pcx2*Pcz2*m2*t2*t6;
	auto t87 = Pcy3*Pcz3*m3*t2*t7;
	auto t89 = Pcy3*Pcz3*m3*t3*t7;
	auto t95 = Icxx2*t2*t3*t6;
	auto t96 = Icxx3*t3*t4*t7;
	auto t99 = Icyy2*t2*t3*t6;
	auto t100 = Icyy3*t2*t3*t6;
	auto t101 = Icyy3*t3*t4*t7;
	auto t126 = Icxy3*t4*t5*t7*2.0;
	auto t142 = Icxx3*t2*t4*t6*t7;
	auto t144 = Icyy3*t2*t4*t6*t7;
	auto t170 = Pcx3*Pcy3*m3*t4*t5*t7*2.0;
	auto t211 = Pcx1*m1*t2*2.4269798E-1;
	auto t212 = Pcy1*m1*t5*2.4269798E-1;
	auto t213 = Pcz2*m2*t5*2.4269798E-1;
	auto t216 = Pcx2*m2*t2*t6*2.4269798E-1;
	auto t217 = Pcx2*m2*t3*t5*2.4269798E-1;
	auto t218 = Pcy3*m3*t2*t7*2.4269798E-1;
	auto t219 = Pcy3*m3*t4*t5*2.4269798E-1;
	auto t220 = Pcx3*m3*t5*t7*2.4269798E-1;
	auto t221 = Pcy2*m2*t5*t6*2.4269798E-1;
	auto t222 = Pcz3*m3*t5*t6*2.4269798E-1;
	auto t223 = Pcx3*m3*t2*t4*2.4269798E-1;
	auto t224 = Pcy2*m2*t2*t3*2.4269798E-1;
	auto t225 = Pcz3*m3*t2*t3*2.4269798E-1;
	auto t231 = Pcx3*m3*t3*t4*t5*2.4269798E-1;
	auto t233 = Pcy3*m3*t3*t5*t7*2.4269798E-1;
	auto t235 = Pcx3*m3*t5*t6*t7*(-2.4269798E-1);
	auto t236 = Pcy3*m3*t2*t6*t7*(-2.4269798E-1);
	auto t238 = Pcy3*m3*t4*t5*t6*(-2.4269798E-1);
	auto t55 = t5*t27;
	auto t57 = t5*t28;
	auto t59 = t5*t29;
	auto t61 = t6*t29;
	auto t62 = t5*t31;
	auto t63 = t6*t31;
	auto t64 = t5*t33;
	auto t65 = -t27;
	auto t66 = -t28;
	auto t67 = -t30;
	auto t68 = -t32;
	auto t69 = -t34;
	auto t70 = -t35;
	auto t71 = Icxx3*t21;
	auto t72 = Icyy3*t21;
	auto t73 = Icxy3*t24;
	auto t74 = t5*t37;
	auto t75 = t6*t38;
	auto t76 = t5*t39;
	auto t77 = t5*t40;
	auto t78 = t6*t40;
	auto t79 = t5*t41;
	auto t84 = t5*t43;
	auto t86 = t5*t45;
	auto t88 = t5*t46;
	auto t90 = t6*t46;
	auto t91 = t2*t3*t29;
	auto t92 = t5*t47;
	auto t93 = t6*t47;
	auto t94 = t5*t49;
	auto t97 = t2*t3*t31;
	auto t98 = t6*t50;
	auto t102 = t2*t3*t35;
	auto t103 = -t43;
	auto t104 = -t45;
	auto t105 = t6*t58;
	auto t107 = -t48;
	auto t108 = -t51;
	auto t109 = -t52;
	auto t111 = -t54;
	auto t112 = -t56;
	auto t113 = -t58;
	auto t119 = Pcx3*Pcy3*m3*t24;
	auto t120 = t21*t30;
	auto t124 = t2*t3*t38;
	auto t125 = t2*t3*t40;
	auto t133 = t21*t38;
	auto t134 = t21*t40;
	auto t135 = t20*t25*2.0;
	auto t136 = t21*t27*2.0;
	auto t137 = t6*t87;
	auto t139 = -t81;
	auto t140 = -t82;
	auto t143 = t3*t4*t7*t30;
	auto t145 = t5*t101;
	auto t146 = -t83;
	auto t147 = -t85;
	auto t148 = -t87;
	auto t154 = -t96;
	auto t156 = -t99;
	auto t161 = t2*t3*t46;
	auto t162 = t2*t3*t47;
	auto t163 = t6*t80;
	auto t164 = t2*t3*t6*t37;
	auto t165 = t3*t4*t7*t38;
	auto t166 = t2*t3*t6*t39;
	auto t168 = t3*t4*t7*t40;
	auto t169 = t2*t3*t6*t41;
	auto t171 = t20*t42*2.0;
	auto t172 = t21*t43*2.0;
	auto t173 = t20*t50*2.0;
	auto t176 = t21*t54*2.0;
	auto t178 = t20*t58*2.0;
	auto t180 = -t142;
	auto t191 = t20*t80*2.0;
	auto t192 = t21*t83*2.0;
	auto t194 = t20*t87*2.0;
	auto t200 = t2*t4*t6*t7*t27*2.0;
	auto t206 = t2*t4*t6*t7*t43*2.0;
	auto t210 = t29+t31+t46+t47;
	auto t214 = -t211;
	auto t215 = -t213;
	auto t226 = -t221;
	auto t227 = -t222;
	auto t228 = -t223;
	auto t229 = t6*t220;
	auto t230 = t6*t223;
	auto t232 = t6*t218;
	auto t234 = t6*t219;
	auto t237 = -t233;
	auto t106 = t6*t59;
	auto t110 = t6*t62;
	auto t114 = -t59;
	auto t115 = -t61;
	auto t116 = -t62;
	auto t117 = -t63;
	auto t118 = -t64;
	auto t121 = t5*t72;
	auto t122 = -t71;
	auto t123 = -t73;
	auto t127 = -t74;
	auto t128 = -t75;
	auto t129 = -t76;
	auto t130 = -t77;
	auto t131 = -t78;
	auto t132 = -t79;
	auto t138 = t6*t88;
	auto t141 = t6*t92;
	auto t149 = -t88;
	auto t150 = -t90;
	auto t151 = -t92;
	auto t152 = -t93;
	auto t153 = -t94;
	auto t155 = -t98;
	auto t157 = t2*t3*t70;
	auto t158 = -t119;
	auto t159 = -t135;
	auto t167 = t2*t3*t78;
	auto t174 = t5*t133;
	auto t175 = t21*t77;
	auto t177 = t21*t55*2.0;
	auto t179 = -t134;
	auto t181 = -t145;
	auto t182 = t2*t3*t6*t71;
	auto t183 = t2*t3*t6*t72;
	auto t184 = -t171;
	auto t185 = -t173;
	auto t187 = -t163;
	auto t188 = -t164;
	auto t190 = -t168;
	auto t193 = t21*t84*2.0;
	auto t196 = t2*t4*t7*t75;
	auto t197 = t5*t165;
	auto t198 = t2*t4*t7*t78;
	auto t199 = t3*t4*t7*t77;
	auto t201 = -t191;
	auto t204 = t2*t3*t21*t75;
	auto t160 = -t121;
	auto t186 = -t177;
	auto t189 = t2*t3*t131;
	auto t195 = -t174;
	auto t202 = -t193;
	auto t203 = -t183;
	auto t205 = t21*t167;
	auto t207 = -t197;
	auto t208 = t2*t4*t7*t131;
	auto t209 = t2*t3*t21*t128;
	auto t239 = t60+t70+t89+t108+t128+t131+t139;
	auto t240 = t33+t49+t65+t66+t101+t103+t104+t115+t117+t136+t150+t152+t154+t165+t172+t190;
	auto t241 = t53+t105+t114+t116+t124+t125+t137+t149+t151+t155+t187+t218+t228+t235+t238;
	auto t242 = t67+t69+t91+t97+t109+t111+t112+t120+t126+t127+t129+t130+t132+t140+t144+t146+t147+t160+t161+t162+t170+t175+t176+t180+t192+t195+t196+t208+t217+t226+t227+t231+t237;
	auto t243 = t25+t26+t42+t44+t50+t55+t57+t68+t80+t84+t86+t95+t100+t106+t107+t110+t113+t118+t138+t141+t143+t148+t153+t156+t157+t159+t166+t169+t178+t181+t182+t184+t185+t186+t188+t189+t194+t199+t200+t201+t202+t203+t205+t206+t207+t209+t212+t214+t215+t216+t219+t220+t224+t225+t230+t236;
	M(0,0) = Icxx3+Icyy1+Iczz0+Iczz2+m1*5.89023094960804E-2+m2*5.89023094960804E-2+m3*5.89023094960804E-2+t36+t37+t39+t40+t41+t72+t122+t123+t133+t158+t179+Icxx1*t19+Icxx2*t19-Icxx3*t19+Icxy1*t22-Icyy1*t19+Icyy3*t19-Pcz1*m1*4.8539596E-1-Iczz2*t19-t19*t36-t19*t37+t5*t52*2.0+t19*t38+t5*t54*2.0-t19*t40+t5*t56*2.0+t5*t82*2.0+t5*t83*2.0+t5*t85*2.0+t19*t71*2.0-t19*t72*2.0-t5*t144*2.0-t19*t133*2.0+t19*t134*2.0-t5*t196*2.0+(Pcx0*Pcx0)*m0+(Pcy0*Pcy0)*m0+(Pcz1*Pcz1)*m1-Pcx2*m2*t3*4.8539596E-1-Icxx2*t19*t20+Pcy2*m2*t6*4.8539596E-1+Icyy2*t19*t20-Icyy3*t19*t20+Pcz3*m3*t6*4.8539596E-1+Iczz3*t19*t20+m1*t11*t19+m2*t14*t19-t2*t3*t59*2.0-t2*t3*t62*2.0-t6*t19*t51*2.0+t19*t20*t37-t19*t20*t39+t19*t20*t40-t5*t21*t54*4.0-t19*t20*t41+t6*t19*t60*2.0-t2*t3*t88*2.0-t2*t3*t92*2.0-t6*t19*t81*2.0-t5*t21*t83*4.0+t19*t20*t72+t6*t19*t89*2.0+t19*t20*t122+t19*t20*t133+t19*t20*t179-Pcx3*m3*t3*t4*4.8539596E-1-Icxy2*t3*t6*t19*2.0+Icxy3*t4*t7*t19*4.0+Pcy3*m3*t3*t7*4.8539596E-1+Pcx1*Pcy1*m1*t22-Icxy3*t4*t7*t19*t20*2.0+t2*t4*t6*t7*t30*2.0+t2*t4*t6*t7*t77*2.0-Pcx2*Pcy2*m2*t3*t6*t19*2.0+Pcx3*Pcy3*m3*t4*t7*t19*4.0-Pcx3*Pcy3*m3*t4*t7*t19*t20*2.0;
	M(0,1) = t243;
	M(0,2) = t242;
	M(0,3) = t241;
	M(1,0) = t243;
	M(1,1) = Icyy2+Iczz1+Iczz3+t36+t37+t38+t40+Icxx2*t20+Icxy2*t23-Icyy2*t20+Icyy3*t20-Iczz3*t20+m1*t11+m2*t14+t6*t51*2.0-t20*t37+t20*t39-t20*t40+t20*t41-t6*t60*2.0+t6*t81*2.0+t20*t71-t20*t72-t6*t89*2.0-t20*t133+t20*t134+Icxy3*t4*t7*t20*2.0+Pcx2*Pcy2*m2*t23+Pcx3*Pcy3*m3*t4*t7*t20*2.0;
	M(1,2) = t240;
	M(1,3) = t239;
	M(2,0) = t242;
	M(2,1) = t240;
	M(2,2) = Icxx3+Iczz2+t37+t39+t40+t41+t72+t122+t123+t133+t158+t179;
	M(2,3) = t210;
	M(3,0) = t241;
	M(3,1) = t239;
	M(3,2) = t210;
	M(3,3) = Iczz3+t38+t40;

	return M;
}