#pragma once
#include <vector>
#include <casadi/casadi.hpp>
#include <Mahi/Casadi/mass_properties.hpp>
using namespace casadi;

SX get_M(const SX& qs){
	SX M = SX::zeros(4,4); 

	auto q0 = qs(0,0);
	auto q1 = qs(1,0);
	auto q2 = qs(2,0);
	auto q3 = qs(3,0);
	auto qd0 = qs(4,0);
	auto qd1 = qs(5,0);
	auto qd2 = qs(6,0);
	auto qd3 = qs(7,0);

	auto t2 = cos(q1);
	auto t3 = cos(q2);
	auto t4 = cos(q3);
	auto t5 = sin(q1);
	auto t6 = sin(q2);
	auto t7 = sin(q3);
	auto t8 = Pcx1*Pcx1;
	auto t9 = Pcx2*Pcx2;
	auto t10 = Pcx3*Pcx3;
	auto t11 = Pcy1*Pcy1;
	auto t12 = Pcy2*Pcy2;
	auto t13 = Pcy3*Pcy3;
	auto t14 = Pcz2*Pcz2;
	auto t15 = Pcz3*Pcz3;
	auto t16 = q1*2.0;
	auto t17 = q2*2.0;
	auto t18 = q3*2.0;
	auto t19 = t2*t2;
	auto t20 = t3*t3;
	auto t21 = t4*t4;
	auto t22 = sin(t16);
	auto t23 = sin(t17);
	auto t24 = sin(t18);
	auto t25 = Icxy2*t2;
	auto t26 = Icxz1*t2;
	auto t27 = Icyz2*t3;
	auto t28 = Icyz3*t4;
	auto t29 = Iczz3*t3;
	auto t30 = Icxx3*t5;
	auto t31 = Icxy3*t6;
	auto t32 = Icxz2*t6;
	auto t33 = Icxz3*t7;
	auto t34 = Icyz1*t5;
	auto t35 = Iczz2*t5;
	auto t36 = m1*t8;
	auto t37 = m2*t9;
	auto t38 = m3*t10;
	auto t39 = m2*t12;
	auto t40 = m3*t13;
	auto t41 = m3*t15;
	auto t42 = Pcx2*Pcy2*m2*t2;
	auto t43 = Pcx1*Pcz1*m1*t2;
	auto t44 = Pcy2*Pcz2*m2*t3;
	auto t45 = Pcy3*Pcz3*m3*t4;
	auto t46 = Pcx3*Pcy3*m3*t6;
	auto t47 = Pcx2*Pcz2*m2*t6;
	auto t48 = Pcx3*Pcz3*m3*t7;
	auto t49 = Pcy1*Pcz1*m1*t5;
	auto t50 = Icxy3*t2*t3;
	auto t51 = Icxz2*t2*t3;
	auto t52 = Icxz3*t2*t4;
	auto t55 = Icxz3*t4*t6;
	auto t56 = Icyz2*t2*t6;
	auto t58 = Icyz3*t2*t7;
	auto t60 = Iczz3*t2*t6;
	auto t64 = Icyz3*t6*t7;
	auto t80 = Pcx3*Pcy3*m3*t2*t3;
	auto t81 = Pcx2*Pcz2*m2*t2*t3;
	auto t82 = Pcx3*Pcz3*m3*t2*t4;
	auto t85 = Pcx3*Pcz3*m3*t4*t6;
	auto t86 = Pcy2*Pcz2*m2*t2*t6;
	auto t88 = Pcy3*Pcz3*m3*t2*t7;
	auto t94 = Pcy3*Pcz3*m3*t6*t7;
	auto t95 = Icxx2*t2*t3*t6;
	auto t96 = Icyy2*t2*t3*t6;
	auto t97 = Icyy3*t2*t3*t6;
	auto t105 = Icxx3*t4*t6*t7;
	auto t108 = Icyy3*t4*t6*t7;
	auto t123 = Pcy2*m2*t6*(3.0/2.0E+1);
	auto t124 = Pcz3*m3*t6*(3.0/2.0E+1);
	auto t127 = Icxy3*t4*t5*t7*2.0;
	auto t134 = Pcx2*m2*t3*(3.0/2.0E+1);
	auto t138 = Icxx3*t2*t3*t4*t7;
	auto t139 = Icyy3*t2*t3*t4*t7;
	auto t169 = Pcx3*Pcy3*m3*t4*t5*t7*2.0;
	auto t181 = Pcx3*m3*t3*t4*(3.0/2.0E+1);
	auto t182 = Pcy3*m3*t3*t7*(3.0/2.0E+1);
	auto t183 = Pcy3*m3*t4*t6*(3.0/2.0E+1);
	auto t184 = Pcx3*m3*t6*t7*(3.0/2.0E+1);
	auto t53 = t3*t28;
	auto t54 = t3*t33;
	auto t57 = t5*t27;
	auto t59 = t5*t28;
	auto t61 = t5*t31;
	auto t62 = t5*t32;
	auto t63 = t5*t33;
	auto t65 = -t26;
	auto t66 = -t27;
	auto t67 = -t28;
	auto t68 = -t29;
	auto t69 = -t32;
	auto t70 = -t33;
	auto t71 = Icxx3*t21;
	auto t72 = Icyy3*t21;
	auto t73 = Icxy3*t24;
	auto t74 = t3*t38;
	auto t75 = t3*t40;
	auto t76 = t5*t37;
	auto t77 = t5*t39;
	auto t78 = t5*t40;
	auto t79 = t5*t41;
	auto t83 = t3*t45;
	auto t84 = t3*t48;
	auto t87 = t5*t44;
	auto t89 = t5*t45;
	auto t90 = t3*t52;
	auto t91 = t5*t46;
	auto t92 = t5*t47;
	auto t93 = t5*t48;
	auto t98 = t3*t58;
	auto t99 = t2*t6*t28;
	auto t101 = t2*t6*t29;
	auto t102 = -t43;
	auto t103 = -t44;
	auto t104 = -t45;
	auto t106 = t2*t6*t33;
	auto t109 = -t47;
	auto t110 = -t48;
	auto t111 = -t51;
	auto t112 = -t52;
	auto t113 = -t55;
	auto t118 = Pcx3*Pcy3*m3*t24;
	auto t119 = t21*t30;
	auto t125 = t2*t6*t38;
	auto t126 = t2*t6*t40;
	auto t130 = t21*t38;
	auto t131 = t21*t40;
	auto t132 = t20*t25*2.0;
	auto t133 = t21*t31*2.0;
	auto t135 = -t124;
	auto t136 = t2*t6*t48;
	auto t140 = -t81;
	auto t141 = -t82;
	auto t142 = -t85;
	auto t146 = t4*t6*t7*t30;
	auto t147 = t5*t108;
	auto t150 = -t96;
	auto t154 = -t127;
	auto t155 = -t108;
	auto t160 = t3*t82;
	auto t161 = -t134;
	auto t162 = t3*t88;
	auto t163 = t2*t6*t45;
	auto t165 = t2*t3*t6*t37;
	auto t166 = t2*t3*t6*t39;
	auto t168 = t2*t3*t6*t41;
	auto t170 = t4*t6*t7*t38;
	auto t171 = t4*t6*t7*t40;
	auto t172 = t20*t42*2.0;
	auto t173 = t21*t46*2.0;
	auto t174 = t21*t50*2.0;
	auto t175 = t20*t52*2.0;
	auto t178 = t20*t58*2.0;
	auto t185 = -t169;
	auto t187 = -t139;
	auto t196 = -t181;
	auto t202 = t21*t80*2.0;
	auto t203 = t20*t82*2.0;
	auto t204 = t20*t88*2.0;
	auto t209 = t2*t3*t4*t7*t31*2.0;
	auto t218 = t2*t3*t4*t7*t46*2.0;
	auto t100 = t5*t53;
	auto t107 = t5*t54;
	auto t114 = -t57;
	auto t115 = -t59;
	auto t116 = -t62;
	auto t117 = -t63;
	auto t120 = t5*t72;
	auto t121 = -t71;
	auto t122 = -t73;
	auto t128 = -t74;
	auto t129 = -t75;
	auto t137 = t5*t84;
	auto t143 = -t87;
	auto t144 = -t89;
	auto t145 = -t90;
	auto t148 = -t92;
	auto t149 = -t93;
	auto t151 = t2*t6*t67;
	auto t152 = t2*t6*t68;
	auto t153 = t2*t6*t70;
	auto t156 = -t118;
	auto t157 = -t132;
	auto t158 = -t119;
	auto t159 = -t133;
	auto t164 = t5*t83;
	auto t167 = t2*t6*t75;
	auto t176 = t5*t130;
	auto t177 = t21*t78;
	auto t179 = t21*t61*2.0;
	auto t180 = -t131;
	auto t186 = t2*t6*t110;
	auto t188 = -t147;
	auto t189 = t2*t3*t6*t71;
	auto t190 = t2*t3*t6*t72;
	auto t191 = -t172;
	auto t192 = -t173;
	auto t193 = -t174;
	auto t194 = -t178;
	auto t197 = t3*t141;
	auto t198 = t2*t6*t104;
	auto t199 = -t165;
	auto t201 = -t170;
	auto t205 = t21*t91*2.0;
	auto t207 = t2*t4*t7*t74;
	auto t208 = t2*t4*t7*t75;
	auto t210 = t5*t170;
	auto t211 = t4*t6*t7*t78;
	auto t212 = -t202;
	auto t213 = -t204;
	auto t216 = t2*t6*t21*t74;
	auto t222 = t67+t70+t104+t110;
	auto t195 = -t179;
	auto t200 = t2*t6*t129;
	auto t206 = -t177;
	auto t214 = -t205;
	auto t215 = -t190;
	auto t217 = t21*t167;
	auto t219 = t2*t4*t7*t128;
	auto t220 = t5*t201;
	auto t221 = t2*t6*t21*t128;
	auto t223 = t64+t68+t94+t113+t128+t129+t142;
	auto t224 = t60+t98+t115+t117+t125+t126+t144+t145+t149+t162+t183+t184+t197;
	auto t225 = t31+t46+t53+t54+t66+t69+t83+t84+t103+t105+t109+t155+t159+t171+t192+t201;
	auto t226 = t30+t35+t50+t56+t76+t77+t78+t79+t80+t86+t111+t120+t123+t135+t138+t140+t151+t153+t154+t158+t161+t176+t182+t185+t186+t187+t193+t196+t198+t206+t208+t212+t219;
	auto t227 = t25+t34+t42+t49+t58+t61+t65+t88+t91+t95+t97+t100+t102+t107+t112+t114+t116+t137+t141+t143+t146+t148+t150+t152+t157+t164+t166+t168+t175+t188+t189+t191+t194+t195+t199+t200+t203+t209+t211+t213+t214+t215+t217+t218+t220+t221;
	M(0,0) = Icxx3+Icyy1+Iczz0+Iczz2+m1*(9.0/4.0E+2)+m2*(9.0/4.0E+2)+m3*(9.0/4.0E+2)+t36+t37+t39+t40+t41+t72+t121+t122+t130+t156+t180+Icxx1*t19-Icxx3*t19+Icxy1*t22-Icyy1*t19+Icyy2*t19-Iczz2*t19+Iczz3*t19+t5*t50*2.0-t19*t36-t5*t51*2.0+t19*t38-t19*t39-t19*t41+t5*t56*2.0+t5*t80*2.0-t5*t81*2.0+t19*t71+t5*t86*2.0-t19*t72-t5*t139*2.0-t19*t130+t19*t131-t5*t207*2.0+t5*t208*2.0+(Pcx0*Pcx0)*m0+(Pcy0*Pcy0)*m0+(Pcz1*Pcz1)*m1-Pcx1*m1*t5*(3.0/1.0E+1)+Icxx2*t19*t20-Pcy1*m1*t2*(3.0/1.0E+1)-Icyy2*t19*t20+Icyy3*t19*t20+Pcz2*m2*t2*(3.0/1.0E+1)-Iczz3*t19*t20+m1*t11*t19+m2*t14*t19-t2*t6*t59*2.0-t2*t6*t63*2.0-t5*t21*t50*4.0-t19*t20*t37-t3*t19*t55*2.0+t19*t20*t39-t19*t20*t40+t19*t20*t41+t3*t19*t64*2.0-t2*t6*t89*2.0-t2*t6*t93*2.0-t5*t21*t80*4.0-t3*t19*t85*2.0+t19*t20*t71-t19*t20*t72+t3*t19*t94*2.0-t19*t20*t130+t19*t20*t131-Pcx2*m2*t3*t5*(3.0/1.0E+1)+Pcx3*m3*t2*t7*(3.0/1.0E+1)+Icxy2*t3*t6*t19*2.0+Icxy3*t4*t7*t19*2.0+Pcy3*m3*t2*t4*(3.0/1.0E+1)+Pcy2*m2*t5*t6*(3.0/1.0E+1)-Pcz3*m3*t5*t6*(3.0/1.0E+1)+Pcx1*Pcy1*m1*t22-Pcx3*m3*t3*t4*t5*(3.0/1.0E+1)+Icxy3*t4*t7*t19*t20*2.0+Pcy3*m3*t3*t5*t7*(3.0/1.0E+1)+t2*t3*t4*t7*t30*2.0+Pcx2*Pcy2*m2*t3*t6*t19*2.0+Pcx3*Pcy3*m3*t4*t7*t19*2.0+Pcx3*Pcy3*m3*t4*t7*t19*t20*2.0;
	M(0,1) = t227;
	M(0,2) = t226;
	M(0,3) = t224;
	M(1,0) = t227;
	M(1,1) = Icxx2+Icyy3+Iczz1+t36+t38+t39+t41+t71-t72+t73+t118-t130+t131-Icxx2*t20-Icxy2*t23+Icyy2*t20-Icyy3*t20+Iczz3*t20+m1*t11+m2*t14+t20*t37+t3*t55*2.0-t20*t39+t20*t40-t20*t41-t3*t64*2.0+t3*t85*2.0+t20*t72-t3*t94*2.0+t20*t121+t20*t130+t20*t180-Icxy3*t4*t7*t20*2.0-Pcx2*Pcy2*m2*t23-Pcx3*Pcy3*m3*t4*t7*t20*2.0;
	M(1,2) = t225;
	M(1,3) = t223;
	M(2,0) = t226;
	M(2,1) = t225;
	M(2,2) = Icxx3+Iczz2+t37+t39+t40+t41+t72+t121+t122+t130+t156+t180;
	M(2,3) = t222;
	M(3,0) = t224;
	M(3,1) = t223;
	M(3,2) = t222;
	M(3,3) = Iczz3+t38+t40;

	return M;
}